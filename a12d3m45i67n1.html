<!DOCTYPE html>
<html lang="ko">
<head>
    <style>
        /* (기존 스타일 유지) */
        
        /* 추가된 업데이트 정보 스타일 */
        .update-status-container {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .status-box {
            font-size: 12px;
            color: #aaa;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 16px;
            border-radius: 50px;
            border: 1px solid #333;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            box-shadow: 0 0 8px #00ff00;
        }
    </style>
</head>
<body>

<div class="container" id="capture-area">
    <div class="calendar-grid" id="calendarGrid"></div>

    <div class="notice-area">
        * 자세한 일정은 방송 공지 참고 <br>
        * 날짜 기록 기준은 당일 오전 6:00 ~ 다음날 오전 5:59 뱅온 기준입니다.
    </div>
</div>

<div class="credit-area no-export">
    <div class="update-status-container">
        <div class="status-box">
            <span class="status-dot"></span>
            <span id="last-db-update">데이터 동기화 대기 중...</span>
        </div>
        <div id="last-github-update" style="font-size: 11px; color: #666;">
            시스템 버전 정보를 확인하고 있습니다...
        </div>
    </div>

    <div class="credit-title">[ 플랜비 캘린더팀 ]</div>
    <div>제작자 - 카피바라, 리크, 김부동, 안즈, 이워리</div>
    <div>웹 디자인 - 카피바라 @workingkapibara</div>
    <div class="copyright">
        해당 제작물의 모든 권리는 원작자(카피바라)에게 있으며, <br>
        플랜비 뮤직의 비공식 팬 제작물입니다.
    </div>
    <div style="margin-top: 20px;">
        <img src="logo.png" alt="PlanB Logo" style="width: 120px; height: auto; opacity: 0.8;">
    </div>
</div>

<script>
    // ... (Firebase 설정 및 기본 변수 선언 동일) ...

    // 1. GitHub 최신 업데이트 시간 가져오기
    async function fetchGitHubUpdate() {
        // 실제 본인의 GitHub '아이디/레포지토리이름'으로 수정하세요.
        const repo = "Kapi-bara/planb-calendar"; 
        try {
            const response = await fetch(`https://api.github.com/repos/${repo}/commits/main`);
            if (response.ok) {
                const data = await response.json();
                const commitDate = new Date(data.commit.author.date);
                const dateStr = commitDate.toLocaleString('ko-KR', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit'
                });
                document.getElementById('last-github-update').textContent = `System Build: ${dateStr} (GitHub main)`;
            } else {
                document.getElementById('last-github-update').textContent = "시스템 버전 정보를 연동할 수 없습니다.";
            }
        } catch (e) {
            document.getElementById('last-github-update').textContent = "GitHub 연결 오류";
        }
    }

    // 2. 동기화 시간 표시 업데이트 함수
    function updateTimestamp() {
        const now = new Date();
        const timeString = now.toLocaleString('ko-KR', { 
            hour12: false,
            year: 'numeric', month: '2-digit', day: '2-digit', 
            hour: '2-digit', minute: '2-digit', second: '2-digit' 
        });
        document.getElementById('last-db-update').textContent = `최근 데이터 동기화: ${timeString}`;
    }

    // ... (renderCalendar, openModal 등 기존 함수 동일) ...

    // [버그 수정된] 자동 저장 함수에 시간 업데이트 로직 통합
    function autoSaveToServer(showMsg = false) {
        const updates = {};
        Object.entries(monthData).forEach(([dateKey, arr]) => {
            if (arr && arr.length > 0) {
                updates[dateKey] = arr;
            }
        });

        db.ref(`monthly/${currentMember}`).set(updates)
            .then(() => {
                updateTimestamp(); // 저장 성공 시 시간 표시 업데이트
                if (showMsg) alert('저장되었습니다.');
            })
            .catch(err => {
                console.error("데이터 동기화 실패:", err);
                document.getElementById('last-db-update').textContent = "동기화 오류 발생";
            });
    }

    // 페이지 로드 시 초기화 실행
    window.onload = () => {
        loadData();
        fetchGitHubUpdate(); // GitHub 정보 가져오기
        updateTimestamp();   // 초기 시간 표시
    };
</script>
</body>
</html>
